<html metal:use-macro="api.layout">
<metal:breadcrumbs metal:fill-slot="breadcrumbs">
  <li>
    <span class="separator">&rarr;</span>
    <a tal:attributes="href api.route_url('control_panel')">Control panel</a>
  </li>
  <li>
    <span class="separator">&rarr;</span>
    Manage administrators
  </li>
</metal:breadcrumbs>

<metal:content metal:fill-slot="content">

<table id="adminListing"
       class="listing">
  <thead>
    <tr>
      <th>User id</th>
      <th>Delete</th>
    </tr>
  </thead>
  <tbody>
    <tr tal:repeat="admin admins"
        tal:attributes="class repeat['admin'].odd and 'odd' or 'even'">
      <td>
        <span tal:replace="admin.fullname"/> (<span tal:replace="admin.login"/>)
      </td>
      <td class="centered">
        <tal:if tal:condition="admin.id == current_user_id">
          (you)
        </tal:if>
        <form tal:condition="admin.id != current_user_id"
              class="ninja"
              tal:attributes="action api.route_url('admin_delete')"
              onsubmit="return window.confirm('Are you sure?');"
              method="POST">
          <input type="hidden" name="admin_id"
                 tal:attributes="value admin.id"/>
          <input type="image" width="16" height="16" alt="delete admin"
                 tal:attributes="src api.static_url('static/img/delete.png')"/>
        </form>
      </td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <td>
        <input type="text" id="admin_id_to_add" name="admin_id_to_add"/>
      </td>
      <td class="centered">
        <form class="ninja"
              tal:attributes="action api.route_url('admin_add')"
              onsubmit="return addAdmin(this);"
              method="POST">
          <input type="hidden" name="user_id"/>
          <input type="image" width="32" height="32" alt="add admin"
                 tal:attributes="src api.static_url('static/img/add.png')"/>
        </form>
      </td>
    </tr>
  </tfoot>
</table>

</metal:content>

<metal:scripts metal:fill-slot="scripts">
  <script>
    /*
      FIXME: I am not too happy to require Javascript to submit a
      form. We should be able to include the text field in the form
      without breaking the layout.
    */
    function addAdmin(form) {
      form.user_id.value = document.getElementById('admin_id_to_add').value;
      return true;
    }
  </script>
</html>
